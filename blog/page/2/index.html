
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Roy Notes</title>
  <meta name="author" content="roymax">
  <meta name="Generator" content="Jekyll & Octopress (http://octopress.org)">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://roynotes.com/blog/page/2/">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/octopress.min.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Roy Notes" type="application/atom+xml">
  

<!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44129046-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


   
  <link href="/octopress-favicon.png" rel="icon">
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Roy Notes</a></h1>
  
    <h2>21世纪的互联网居民</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:roynotes.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives/">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/11/copy-finder-path-to-terminal/">Copy Finder Path to Terminal</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-11-24T17:29:00+08:00" pubdate data-updated="true">Nov 24<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/11/copy-finder-path-to-terminal/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>我们有时需要从Finder中将当前路径复制到控制台中，但这路径有时长得令人发指，即使使用Tab键辅助也是很困难。奇怪的是，就这样一个小需求OSX也没有提供。</p>

<p>这是一个有关Finder的小技巧，其实你只需要将Finder上的文件夹拖放到Terminal就可以了，详见视频。</p>

<p><video width='640' height='320' preload='none' controls poster=''><source src='http://d.pr/v/mapm/play' type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'/></video>
如无法播放点击<a href="http://d.pr/v/mapm">这里</a>下载</p>

<p>另外推荐一下DTerm这个免费的Terminal工具可以跟Finder配合着使用，通过热键<code>⌘+⇧+↵</code>呼出后就直接在Finder的当前路径进行Terminal操作，相当方便。而且可以跟IDE配合着使用，<a href="http://decimus.net/DTerm">官方首页</a>有详细的介绍及视频展示</p>

<p><img class="" src="http://d.pr/i/6Xbf+"></p>

<p>UPDATE:</p>

<p><em>通过DTerm快速在当前目录打开Terminal</em>，在Finder中热键<code>⌘+⇧+↵</code>呼出DTerm，再按<code>⌘+↵</code></p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/11/problems-with-meteor/">Problems With Meteor</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-11-17T12:04:00+08:00" pubdate data-updated="true">Nov 17<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/11/problems-with-meteor/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>最近一个月关注了一下几个前端MVC库，包括有Emberjs/Angularjs/Meteorjs/Backbonejs等，发现所谓的前端后端的界线越来越模糊了。</p>

<p>Angularjs非常吸引人，看起来真的不错，而且还是由google这个业界巨头开源出来，质量值得信任。如果已经有一个良好的后端架构支持，Angularjs/Backbonejs之间必定任选其一都不会错，说到底就是看用哪家的API更舒服一些了。</p>

<p>如果从零开始学习或玩票性质地想做一些尝试性项目，我个人推崇Meteor。这个家伙启动成本真的很低很低，一体化的框架，基于nodejs+mongodb，社区也足够的活跃。当然了，优点也就是缺点，Full Stack Framework就是意味着一些制约了。</p>

<p>Emberjs则有点像Rails，或者直接说就是一个完全遵循Rails思想的框架，而且天生就跟Rails做高整合。如果熟悉Rails并且有一个基于Rails的后端或许是一个不错的选择，但个人感觉学习曲线有点徒（当然这更多是臆测，因为个人上手感觉不大习惯）。</p>

<p>另外还有几个Knockout/CanJS/Batman/Spine就没细看了，从github上的fork和wacth来看，感觉社区活跃度都比不上前面提到的几家。</p>

<p>最后尝试用<a href="http://www.meteor.com">meteor</a>写一个app，遇到一些小问题并记录下来</p>

<h2>加载nodejs package</h2>

<p>Meteor实际上基于nodejs，所以可以直接加载nodejs已有的package</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ meteor create myapp
</span><span class='line'>$ cd myapp/.meteor/local/build/server
</span><span class='line'>$ npm install &lt;package></span></code></pre></td></tr></table></div></figure>


<p>然后用以下方法加载</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>var pkg = __meteor_bootstrap__.require('package_name');</span></code></pre></td></tr></table></div></figure>


<h2>项目结构</h2>

<p>Meteor 有两种方式拆分服务端和客户端代码</p>

<ol>
<li>使用<code>Meteor.is_client</code>和<code>Meteor.is_server</code>区别代码块，<code>meteor create project</code>后生成的代码就是用这种方法。</li>
<li>将服务端和客户端代码分别放到项目根目录下的<code>server</code>和<code>client</code>文件夹。</li>
</ol>


<p>使用第二种方式，需要在项目目录下新建<code>server</code>和<code>client</code>目录，并将Meteor生成的项目的主文件分别拆分到目录，分别命名为<code>${ROOT}/server/proj_server.js</code>和<code>${ROOT}/client/proj_client.js</code>。</p>

<p>另外，在项目根目录下的js文件可以设置公共的方法和变量，它能同时被server和client端调用。</p>

<h2>使用Meteor.http特性</h2>

<p>因为文档看得不够仔细，总是得到一个undefined的错误，后来发现Meteor.http也是Packages之一，所以需要<code>meteor add http</code>才可以使用。</p>

<h2>关于编码</h2>

<p>如果需要通过<code>Meteor.http.get</code>方法获取non-UTF8的内容就需要注意，因为Meteor将response设置成 UTF8返回，并不可以指定encoding。如果确认需要这处理GBK这个字符集，那么需要一点hacking code</p>

<p>修改<code>packages/http/httpcall_server.js</code>文件</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>     var req_options = {
</span><span class='line'>       url: new_url,
</span><span class='line'>       method: method,
</span><span class='line'>-      encoding: "utf8",
</span><span class='line'>+      encoding: options.encoding || "utf8",
</span><span class='line'>       jar: false,
</span><span class='line'>       timeout: options.timeout,
</span><span class='line'>       body: content,</span></code></pre></td></tr></table></div></figure>


<p>然后，你可以这样做</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>  Meteor.methods({getMyFunds: function() {
</span><span class='line'>    this.unblock();
</span><span class='line'>    var result = Meteor.http.get("http://hq.sinajs.cn/list=of110002"
</span><span class='line'>      , { encoding: "base64" }
</span><span class='line'>      );
</span><span class='line'>    if (result.statusCode === 200) {
</span><span class='line'>        var require = __meteor_bootstrap__.require;
</span><span class='line'>        var Iconv = require('iconv').Iconv;
</span><span class='line'>        var iconv = new Iconv('GBK', 'UTF-8//TRANSLIT//IGNORE');
</span><span class='line'>        return iconv.convert(new Buffer(result.content,'base64')).toString();
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>  }});</span></code></pre></td></tr></table></div></figure>

</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/11/kanban-in-process/">Kanban in Process</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-11-17T11:16:00+08:00" pubdate data-updated="true">Nov 17<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/11/kanban-in-process/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>重新做了一块看板应用到一个新项目组，并执行三周，继续探索中&#8230;</p>

<h2>简介</h2>

<p>看板的三个主要原则：</p>

<ul>
<li>可视化流程</li>
<li>限制工作的数量</li>
<li>改善周期</li>
</ul>


<h3>约定</h3>

<ul>
<li>所有原始需求放到redmine中</li>
<li>所有的Bug通过redmine提交</li>
<li>黄色便签代表 backlog/story/task</li>
<li>红色便签代表 bug</li>
<li>当前任务项贴上自己的磁贴标记</li>
<li>每周一收集上一周的工作数据</li>
<li>每天早上10点进行立会</li>
<li>按需召开产品分析会议

<ul>
<li>看板上任务不够了</li>
<li>功能优先级调整了</li>
</ul>
</li>
<li>流程顺序，从上到下从左到右</li>
<li>按需发布，由产品负责人决定</li>
<li>每周一收集上周的WIP产生CFD(Cumulative Flow Graph)</li>
</ul>


<h3>需求分析会议上需要明确的内容</h3>

<ul>
<li>任务分解</li>
<li>设计需时</li>
<li>开发需时</li>
<li>按功能优先级制定冲刺目标</li>
</ul>


<h2>版本控制的约定</h2>

<h3>开发过程</h3>

<ul>
<li>基于gitflow的分支模型</li>
<li><code>master</code>分支设置为产品分支，并设置为保护模式，开发人员不能向该分支push代码</li>
<li><code>develop</code>分支设置为开发分支，开发人员每进行一个功能或bug修改需要新建分支操作并完成后合并回来</li>
</ul>


<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>git flow feature start &lt;feature_name>
</span><span class='line'>git add &lt;file>
</span><span class='line'>git ci 
</span><span class='line'># and more ...
</span><span class='line'># need a help?
</span><span class='line'># git flow feature publish &lt;feature_name>
</span><span class='line'># done!
</span><span class='line'>git flow feature finish &lt;feature_name>
</span><span class='line'>git pull origin develop
</span><span class='line'>git push origin develop</span></code></pre></td></tr></table></div></figure>


<h3>发布过程</h3>

<ul>
<li>产品人员决定需要发布时间和特性</li>
<li>所有列入发布范围的特性生成一个<code>release branch</code>待验收测试</li>
<li>所有未列入发布范围的功能或缺陷停止提交到<code>develop</code></li>
<li>所有基于<code>release branch</code>的修改在该分支上进行</li>
<li>发布成功后，发布版本打上指定版本标签，<code>develop</code>允许开放提交</li>
</ul>


<h3>版本标签</h3>

<p>版本标签以<code>x.y.z</code>标记，</p>

<ul>
<li>x 代表重大版本变更</li>
<li>y 代表较多功能特性增加及变更</li>
<li>z 代表针对现有功能做出变更</li>
</ul>

</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/04/zi-dong-tian-jia-vpnlu-you/">Mac osx自动添加VPN路由</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-04-09T17:51:00+08:00" pubdate data-updated="true">Apr 9<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/04/zi-dong-tian-jia-vpnlu-you/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>最近需要频繁使用VPN拨号，但由于网段不一样，每次连上后都需要手工添加路由，在Mac下同样可以通过ip-up和ip-down自动完成路由的添加。</p>

<div><script src='https://gist.github.com/2342505.js?file='></script>
<noscript><pre><code>#!/bin/sh

# VPN_GATEWAY is the remote address of the vpn tunnel
# when ppp executes this script it will pass several values to it
# $5 will hold the remote gateway
VPN_GATEWAY=192.168.20.239
if [ &quot;${5:-}&quot; = &quot;${VPN_GATEWAY}&quot; ]
then
    /sbin/route add 192.168.30.0/24 $5
fi</code></pre></noscript></div>


<p>非常简单的代码，其中第7行的${5:-} 对应远程IP地址，另还有以下参数可以使用</p>

<pre><code>$1 the interface name used by pppd (e.g. ppp3)
$2 the tty device name
$3 the tty device speed
$4 the local IP address for the interface
$5 the remote IP address
$6 the parameter specified by the 'ipparam' option to pppd
</code></pre>

<p>最后，必须赋执行权限</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ sudo chmod a+x /etc/ppp/ip-up
</span><span class='line'>
</span><span class='line'>#查看是否添加成功
</span><span class='line'>$ netstat -nr</span></code></pre></td></tr></table></div></figure>



</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/02/about-treatment-question/">待遇问题</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-02-24T00:49:00+08:00" pubdate data-updated="true">Feb 24<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/02/about-treatment-question/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>农历年回来后就一直非常紧张地进行招聘工作，幸运的是在不到一个月的时间能够确定了三位技术新同事。</p>

<p>在本周一扎堆报到时的确是让我异常的兴奋，今年的团队建设任务在开始阶段就成效不错。三位新同事中还有两位是资深技术人员，这非常重要，因为今年团队招聘名额不多，但在创业团队中组成一个倒三角架构是可以减少犯错机会的。</p>

<p>遗憾的是在今天其中一位因<code>待遇问题</code>选择了离开，祝福这位共事两天的同事寻觅到自己另一份理想工作。</p>

<p>我们是家创业公司，运营的四年来并没有拿过风投一分钱过日子，我们不太可能给出超越经营成本的薪资成满足大家的待遇要求。事实上，我们也在尽量匹配市场的薪资水平，甚至在有合适的人材时以略超出薪资体系结构的月薪来保持竞争力。</p>

<p><code>待遇问题</code>真是一个好问题，评判标准因人而异，而且没有谁对谁错。判断对错时如果不是过于在乎短期收益，那么最好想想对公司能给予多少的附加值，附加值包括但不限于：</p>

<ul>
<li>是否有充足的成长空间</li>
<li>对行业方向是否认同、一致</li>
<li>是否存在长期投资回报收益（公司可持续发展性）</li>
<li>公司气氛、文化是否吻合</li>
<li>技术创新程度</li>
<li>价值观又是否一致</li>
<li>上司是一个怎样的人</li>
</ul>


<p>这些都属于我值得关注的<code>待遇问题</code>，绝不单纯因为月薪的短期或多或少去加入一家公司，不能臭味相投及DNA不匹配的公司会令我工作得非常痛苦。</p>

<p>未来的时间我们将继续寻找合适的工作伙伴，如果你是一位有多年工作经验的Java开发者，对Rails感兴趣，熟悉linux，非常欢迎将简历投递到邮箱<code>roy.wei#xiangrikui.com</code>。</p>

<p>如果希望了解更多，可以访问 <a href="http://www.xiangrikui.com">向日葵保险网</a></p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/02/node-restify-intro/">Node-restify 简介</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-02-19T22:18:00+08:00" pubdate data-updated="true">Feb 19<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/02/node-restify-intro/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p><a href="https://github.com/mcavage/node-restify">restify</a> 是<a href="http://nodejs.org">Node.js</a>的模块。虽然<code>restify</code>的API或多或少的参考了<a href="http://expressjs.com/">express</a>，但<code>restify</code>不是一个MVC框架，它是一套为了能够正确构建REST风格API而诞生的框架。</p>

<h3>安装restify</h3>

<p>将<code>restify</code>安装到目录<code>restify-dmeo</code></p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ mkdir restify-demo
</span><span class='line'>$ cd restify-demo
</span><span class='line'>$ npm install restify</span></code></pre></td></tr></table></div></figure>


<h3>Hello World</h3>

<figure class='code'><figcaption><span>app.js</span></figcaption><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">restify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;restify&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">respond</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s1">&#39;hello &#39;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/hello/:name&#39;</span><span class="p">,</span> <span class="nx">respond</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;%s listening at %s&#39;</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>保存文件并执行</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">node</span> <span class="nx">app</span><span class="p">.</span><span class="nx">js</span>
</span><span class='line'><span class="nx">restify</span> <span class="nx">listening</span> <span class="nx">at</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//0.0.0.0:8080</span>
</span></code></pre></td></tr></table></div></figure>


<p>通过curl命令测试，服务器返回HTTP状态码<code>200</code>和一个<code>application/json</code>类型的内容(事实上这里不是)</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span> <span class="nx">curl</span> <span class="o">-</span><span class="nx">is</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:8080/hello/roy</span>
</span><span class='line'><span class="nx">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="nx">OK</span>
</span><span class='line'><span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Allow</span><span class="o">-</span><span class="nx">Origin</span><span class="o">:</span> <span class="o">*</span>
</span><span class='line'><span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Allow</span><span class="o">-</span><span class="nx">Headers</span><span class="o">:</span> <span class="nx">Accept</span><span class="p">,</span> <span class="nx">Accept</span><span class="o">-</span><span class="nx">Version</span><span class="p">,</span> <span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="p">,</span> <span class="nx">Content</span><span class="o">-</span><span class="nx">MD5</span><span class="p">,</span> <span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="p">,</span> <span class="nb">Date</span><span class="p">,</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Api</span><span class="o">-</span><span class="nx">Version</span>
</span><span class='line'><span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Expose</span><span class="o">-</span><span class="nx">Headers</span><span class="o">:</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Api</span><span class="o">-</span><span class="nx">Version</span><span class="p">,</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Request</span><span class="o">-</span><span class="nx">Id</span><span class="p">,</span> <span class="nx">X</span><span class="o">-</span><span class="nx">Response</span><span class="o">-</span><span class="nx">Time</span>
</span><span class='line'><span class="nx">Server</span><span class="o">:</span> <span class="nx">restify</span>
</span><span class='line'><span class="nx">X</span><span class="o">-</span><span class="nx">Request</span><span class="o">-</span><span class="nx">Id</span><span class="o">:</span> <span class="nx">ec3e9e55</span><span class="o">-</span><span class="mi">7083</span><span class="o">-</span><span class="mi">4</span><span class="nx">e12</span><span class="o">-</span><span class="mi">93</span><span class="nx">ee</span><span class="o">-</span><span class="mi">9</span><span class="nx">c24a0c5c398</span>
</span><span class='line'><span class="nx">Access</span><span class="o">-</span><span class="nx">Control</span><span class="o">-</span><span class="nx">Allow</span><span class="o">-</span><span class="nx">Methods</span><span class="o">:</span> <span class="nx">GET</span>
</span><span class='line'><span class="nx">Connection</span><span class="o">:</span> <span class="nx">close</span>
</span><span class='line'><span class="nx">Content</span><span class="o">-</span><span class="nx">Length</span><span class="o">:</span> <span class="mi">5</span>
</span><span class='line'><span class="nx">Content</span><span class="o">-</span><span class="nx">MD5</span><span class="o">:</span> <span class="mi">65</span><span class="nx">tW24XBT3r1jLUpw0o0Fw</span><span class="o">==</span>
</span><span class='line'><span class="nx">Content</span><span class="o">-</span><span class="nx">Type</span><span class="o">:</span> <span class="nx">application</span><span class="o">/</span><span class="nx">json</span>
</span><span class='line'><span class="nb">Date</span><span class="o">:</span> <span class="nx">Sun</span><span class="p">,</span> <span class="mi">19</span> <span class="nx">Feb</span> <span class="mi">2012</span> <span class="mi">16</span><span class="o">:</span><span class="mi">14</span><span class="o">:</span><span class="mi">13</span> <span class="nx">GMT</span>
</span><span class='line'><span class="nx">X</span><span class="o">-</span><span class="nx">Response</span><span class="o">-</span><span class="nx">Time</span><span class="o">:</span> <span class="mi">3</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&quot;hello roy&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>特性</h3>

<p>接触到<code>restify</code>是因为内部系统需要一个手机归属地的查询接口，基于<code>nodejs</code>和<code>redis</code>的高性能实现，决定快速实现一个，当时也很自然地选择了<code>express</code>作为web层。但<code>express</code>始终是一个Web MVC框架，它包含了一些我不太需要的功能实现（i.e., templating/rendering）。而我只是需要一个更纯粹的API接口而已&#8211;接收请求然后返回一个<code>JSON</code>结果集。</p>

<p>后来从推上找到了<code>restify</code>时，我就觉得这才是我想要的：</p>

<ol>
<li><p>路由</p>

<ul>
<li>基本等同于<code>express</code>/<code>sinatra</code>的路由方式</li>
<li>路由正则表达式支持</li>
<li>版本化支持</li>
</ul>
</li>
<li><p>自动选择内容格式进行响应，并可以自定义格式</p></li>
<li><p>内置REST风格的错误处理机制，重载了400和409来解析应答，得到一个包含<code>code</code>和<code>message</code>的JSON对象。也可以子类化<code>restify.RestError</code>实现自己错误代码和信息。</p>

<p> 已实现的RestError:</p>

<ul>
<li>RestError</li>
<li>BadDigestError</li>
<li>BadMethodError</li>
<li>InternalErrorError</li>
<li>InvalidArgumentError</li>
<li>InvalidContentError</li>
<li>InvalidCredentialsError</li>
<li>InvalidHeaderError</li>
<li>InvalidVersionError</li>
<li>MissingParameterError</li>
<li>NotAuthorizedError</li>
<li>RequestExpiredError</li>
<li>RequestThrottledError</li>
<li>ResourceNotFoundError</li>
<li>WrongAcceptError</li>
</ul>
</li>
<li><p>插件机制</p></li>
<li><p>DTrace支持，这个绝对是调式、诊断和性能测量利器</p></li>
</ol>


<p>虽然现在<code>restify</code>还是初生婴儿，我还是把上面提到的手机归属地查询接口改用了<code>restify</code>来实现了一个<a href="https://github.com/roymax/moquery">moquery</a>。</p>

<p>正如官方描述一样</p>

<pre><code>restify is a smallish framework, similar to `express` for building REST APIs. 
</code></pre>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/01/installing-gitlab-on-ubuntu-server-11-dot-10/">Installing GitLab on Ubuntu Server 11.10</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-01-20T14:20:00+08:00" pubdate data-updated="true">Jan 20<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/01/installing-gitlab-on-ubuntu-server-11-dot-10/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>打算在团队内推广Git，替换掉当前使用的SVN。所以打算挑选一个类GitHub的管理界面，最终在GitLab和Gitblit中选择了前者。本文为<a href="http://gitlabhq.com/">GitLab</a>在虚拟机下的安装过程。</p>

<h3>安装Ubuntu 11.10</h3>

<p>安装好Ubuntu Server后，我设置源指向163</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ sudo cp /etc/apt/sources.list /etc/apt/sources.list.backup
</span><span class='line'>$ sudo echo "" > /etc/apt/sources.list</span></code></pre></td></tr></table></div></figure>


<p>编辑source.list加入</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>deb http://mirrors.163.com/ubuntu/ oneiric main universe restricted multiverse 
</span><span class='line'>deb-src http://mirrors.163.com/ubuntu/ oneiric main universe restricted multiverse 
</span><span class='line'>deb http://mirrors.163.com/ubuntu/ oneiric-security universe main multiverse restricted 
</span><span class='line'>deb-src http://mirrors.163.com/ubuntu/ oneiric-security universe main multiverse restricted 
</span><span class='line'>deb http://mirrors.163.com/ubuntu/ oneiric-updates universe main multiverse restricted 
</span><span class='line'>deb http://mirrors.163.com/ubuntu/ oneiric-proposed universe main multiverse restricted 
</span><span class='line'>deb-src http://mirrors.163.com/ubuntu/ oneiric-proposed universe main multiverse restricted 
</span><span class='line'>deb http://mirrors.163.com/ubuntu/ oneiric-backports universe main multiverse restricted 
</span><span class='line'>deb-src http://mirrors.163.com/ubuntu/ oneiric-backports universe main multiverse restricted 
</span><span class='line'>deb-src http://mirrors.163.com/ubuntu/ oneiric-updates universe main multiverse restricted</span></code></pre></td></tr></table></div></figure>


<p>更新服务器并安装一些必要软件</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ sudo apt-get update
</span><span class='line'>$ sudo apt-get dist-upgrade -y
</span><span class='line'>$ sudo apt-get install git-core openssh-server sendmail curl gcc libxml2-dev libxslt-dev sqlite3 libsqlite3-dev libcurl4-openssl-dev libreadline-dev libc6-dev libssl-dev libmysql++-dev make build-essential zlib1g-dev python-setuptools  </span></code></pre></td></tr></table></div></figure>


<p>如果使用VMWare的虚拟机，最好安装一下VMWare-tools</p>

<h3>安装rvm &amp; ruby</h3>

<p>gitlab需要使用ruby 1.9.2-p290，习惯了使用rvm来管理ruby版本，所以把rvm也安装一下</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ sudo bash -s stable &lt; &lt;(curl -s https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer )
</span><span class='line'>$ source /etc/profile.d/rvm.sh
</span><span class='line'>$ type rvm | head -1
</span><span class='line'>rvm is a function
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#Rubies installed in system, gemsets separated per user:
</span><span class='line'>$ rvm user gemsets
</span><span class='line'>$ rvmsudo rvm install 1.9.2
</span><span class='line'>$ sudo -H -i   #切换到root
</span><span class='line'>$ rvm --default use 1.9.2
</span><span class='line'>$ exit #退出root
</span><span class='line'>$ rvm reload
</span><span class='line'>$ ruby -v
</span><span class='line'>ruby 1.9.2p290 (2011-07-09 revision 32553) [x86_64-linux]
</span><span class='line'>
</span></code></pre></td></tr></table></div></figure>


<p>基于速度的原因，把rubygem的源调整成<a href="http://ruby.taobao.org">taobao</a>的</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ gem sources -a http://ruby.taobao.org/
</span><span class='line'>$ gem sources --remove http://rubygems.org/
</span><span class='line'>$ gem sources -l 
</span><span class='line'>*** CURRENT SOURCES ***
</span><span class='line'>
</span><span class='line'>http://ruby.taobao.org/
</span><span class='line'>$ </span></code></pre></td></tr></table></div></figure>


<p>淘宝镜像上第1，2行跟我这里反过来的，按官网写法我无法删除rubygems的源，另外我的source文件<code>rubygems.org</code>域名后面是有<code>/</code>的，所以也要加入才能删除。</p>

<p>或直接通过手工编辑<code>vi ~/.gemrc</code>删除。</p>

<p>由于使用了rvm多用户模式所以部分命令需要加上<code>rvmsudo</code> 进行。</p>

<h3>安装rails</h3>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ rvmsudo gem update --system 1.8.14 #安装1.8.15会出错
</span><span class='line'>$ rvmsudo gem install rails</span></code></pre></td></tr></table></div></figure>


<p>或安装GitLab指定版本</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ rvmsudo gem install rails -v 3.1.1 --no-ri --no-rdoc</span></code></pre></td></tr></table></div></figure>


<h3>安装和设置Gitolite</h3>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ sudo adduser \
</span><span class='line'>  --system \
</span><span class='line'>  --shell /bin/sh \
</span><span class='line'>  --gecos 'git version control' \
</span><span class='line'>  --group \
</span><span class='line'>  --disabled-password \
</span><span class='line'>  --home /home/git \
</span><span class='line'>  git
</span><span class='line'>
</span><span class='line'># Add your user to git group
</span><span class='line'>$ sudo usermod -a -G git `eval whoami` 
</span><span class='line'>
</span><span class='line'># Create ssh key
</span><span class='line'>$ ssh-keygen -t rsa
</span><span class='line'>
</span><span class='line'># copy your pub key to git home
</span><span class='line'>sudo cp ~/.ssh/id_rsa.pub /home/git/rails.pub
</span><span class='line'>
</span><span class='line'># clone gitolite
</span><span class='line'>sudo -u git -H git clone git://github.com/gitlabhq/gitolite /home/git/gitolite
</span><span class='line'>
</span><span class='line'># install gitolite
</span><span class='line'>sudo -u git -H /home/git/gitolite/src/gl-system-install
</span><span class='line'>
</span><span class='line'># Setup (Dont forget to set umask as 0007!! 搜索0077修改为0007)
</span><span class='line'>sudo -u git -H sh -c "PATH=/home/git/bin:$PATH; gl-setup ~/rails.pub"
</span><span class='line'>
</span><span class='line'>sudo chmod -R g+rwX /home/git/repositories/
</span><span class='line'>sudo chown -R git:git /home/git/repositories/
</span></code></pre></td></tr></table></div></figure>


<p>检查gitolite安装是否成功，先重新登录确保已经加入git用户组</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'># clone admin repo to add localhost to known_hosts
</span><span class='line'># & be sure your user has access to gitolite
</span><span class='line'>git clone git@localhost:gitolite-admin.git /tmp/gitolite-admin 
</span><span class='line'>
</span><span class='line'># if succeed  you can remote it
</span><span class='line'>rm -rf /tmp/gitolite-admin 
</span></code></pre></td></tr></table></div></figure>


<p>如果有下面类似提示</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>perl: warning: Setting locale failed.
</span><span class='line'>perl: warning: Please check that your locale settings:
</span><span class='line'>  LANGUAGE = "en_US:",
</span><span class='line'>  LC_ALL = (unset),
</span><span class='line'>  LC_CTYPE = "zh_CN.UTF-8",
</span><span class='line'>  LANG = "en_US.UTF-8"
</span><span class='line'>    are supported and installed on your system.
</span></code></pre></td></tr></table></div></figure>


<p>编辑<code>sudo vi /etc/environment</code>添加以下内容到最后</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>LC_ALL="en_US.UTF-8"
</span><span class='line'>LANG="en_US.UTF-8"
</span><span class='line'>LANGUAGE="zh:en_US:en"</span></code></pre></td></tr></table></div></figure>


<p>保存后执行<code>source  /etc/environment</code>使其生效。</p>

<h3>安装和设置GitLab</h3>

<p>这里安装的是GitLab的Stable 2.1版本</p>

<h5>安装GitLab必须包</h5>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ sudo apt-get install python-dev python-pip sendmail redis-server libicu-dev
</span><span class='line'>$ sudo pip install pygments
</span><span class='line'>$ sudo gem install bundler</span></code></pre></td></tr></table></div></figure>


<h3>安装gitlab</h3>

<p>按个人习惯将gitlab装在<code>/usr/local</code>目录下</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ sudo git clone -b stable git://github.com/gitlabhq/gitlabhq.git
</span><span class='line'>$ sudo chown -R `eval whoami`:`eval whoami` /usr/local/gitlabhq
</span><span class='line'>$ cd /usr/local/gitlabhq
</span><span class='line'>$ rvmsudo gem install charlock_holmes -v '0.6.8'</span></code></pre></td></tr></table></div></figure>


<p>修改GemFile的<code>http://rubygems.org</code>为<code>http://ruby.taobao.org/</code>，然后</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ bundle install --without development test 
</span><span class='line'>$ bundle exec rake db:setup RAILS_ENV=production
</span><span class='line'>$ bundle exec rake db:seed_fu RAILS_ENV=production</span></code></pre></td></tr></table></div></figure>


<h3>Start Server</h3>

<p><code>bundle exec rails s -e production</code></p>

<h3>测试安装</h3>

<p>打开 <code>http://&lt;ip&gt;:3000</code>，使用以下帐号和密码登录</p>

<p>User - <code>admin@local.host</code>
Password  - <code>5iveL!fe</code></p>

<p>进入<code>http://&lt;ip&gt;:3000/admin/users</code>新增一个用户，完成后退出管理帐号。</p>

<p>使用刚新增的用户登录，并进入<code>http://&lt;ip&gt;:3000/keys</code>添加一个ssh key，如果没有则生成一个（可以参考<a href="http://help.github.com/mac-set-up-git/">github设置你的Git</a>）。</p>

<p>返回首页，新建一个<code>project</code>成功后按系统提示操作</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>$ mkdir mylab
</span><span class='line'>$ cd mylab
</span><span class='line'>$ git init
</span><span class='line'>$ touch README
</span><span class='line'>$ git add README
</span><span class='line'>$ git commit -m 'first commit'
</span><span class='line'>$ git remote add origin git@localhost:mylab.git   #将loaclhost换成你的ip
</span><span class='line'>$ git push -u origin master</span></code></pre></td></tr></table></div></figure>


<p>如果push成功，你应该可以通过浏览<code>http://&lt;ip&gt;:3000/mylab/repository</code>看到刚刚的第一次提交。</p>

<h3>后续安装</h3>

<p>通过安装<code>Passenger+Nginx</code>可以使用系统管理更加方便，可以<a href="https://github.com/gitlabhq/gitlabhq/wiki/V2.0-easy-setup-for-ubuntu">参考官方文档</a>介绍。</p>

<p>Enjoy!</p>

<hr />

<h3>参考资料</h3>

<ol>
<li><a href="http://firehare.blog.51cto.com/809276/743509">如何在Ubuntu Server 11.10上安装GitLab</a></li>
<li><a href="http://www.ossxp.com/doc/git/gitolite.html">Gitolite 构建 Git 服务器</a></li>
<li><a href="https://github.com/gitlabhq/gitlabhq/wiki/Gitolite">Create git user &amp; install gitolite</a></li>
<li><a href="http://www.ryanwersal.com/blog/2011/10/18/installing-gitlab-on-ubuntu-server/">Installing GitLab on Ubuntu Server</a></li>
<li><a href="https://github.com/gitlabhq/gitlabhq/wiki/Ubuntu.stable">GitLab stable版Ubuntu安装</a></li>
</ol>

</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/2012/01/an-zhuang-autoddvpn/">安装autoddvpn</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-01-19T16:27:00+08:00" pubdate data-updated="true">Jan 19<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/blog/2012/01/an-zhuang-autoddvpn/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>在家已经成功部署autoddvpn近两个月，所以在家里上网的感觉特好（偶尔拉风一下），特记录下来为大家做一次明灯。</p>

<h3>动机</h3>

<p>在用dd-wrt方案前，我用的是ssh tunnel再加上本地autopac，基本已经是一个无敌的解决方案了，也特靠谱的。但家里设备一多，你得想尽办法为每台设备折腾一下，找解决方案。折腾的这些东西都是很折腾人的。与其这样，何不在路由上做功夫，一劳永逸呢。</p>

<h3>需要环境</h3>

<ul>
<li>有一台可刷DD-WRT的设备 ( <a href="http://dd-wrt.com/site/support/router-database">你的路由支持吗？</a> )</li>
<li>一个PPTP或OpenVPN 帐号</li>
<li>ADSL上网环境</li>
</ul>


<h3>准备</h3>

<h5>关于DD-WRT路由器</h5>

<p>家里正好有两台设备，一台是D-Link DIR-605 D1 ,通过查询是wip状态:</p>

<p>work in progress, router support is in the works, but please don&#8217;t ask how long it takes, we cannot give you a schedule in the most cases.</p>

<p>另一台为Netgear WGR614 v9，非常悲剧也是wip。正要放弃准备购买新设备时得知，DIR-605可以刷DIR-615 D2，经过两个晚上的几个小时尝试最终也刷成功，但最后我还是买了一台路由器，因为DIR-605无论如何也支持不了OpenVPN。</p>

<p>如果设备支持OpenVPN，在下载页会列出标有vpn字样的下载链接</p>

<p>我为什么需要OpenVPN？因为我拥有一个Astrill的VPN帐号<a href="http://xcarshop.com" title="Astrill推广链接">推广链接</a>，就因为这个家伙介绍支持DD-WRT我才知晓可以这样玩. Astrill VPN本身是不支持多设备同时登录，通过DD-WRT则可允许7台设备同时使用。</p>

<p>当时我还不知道有autoddvpn这个东西，只能按Astrill的安装介绍来寻找一台支持OpenVPN版本的DD-WRT路由器了。而<a href="https://www.astrill.com/knowledge-base/52/What-Router-for-OpenVPN.html">Astrill推荐</a>了<strong>Asus RT-N16</strong>和<strong>Linksys WRT 160N</strong>，刚好有朋友从香港回来就托运了一台，这样又多花费550人左右。所以我最后用的设备是RT-N16。</p>

<p>事实上，你不需要OpenVPN，用PPTP也是可以的，只要按照autoddvpn的文档写好你的脚本。通过Astrill的安装界面只是图个方便而已。这里我用“可能”来描述是因为我没有进行测试。只不过到后来我也放弃了Astrill的内置安装模式。</p>

<h5>关于PPTP或OpenVPN帐号</h5>

<p>刚才我说了，我的解决方案是<a href="http://xcarshop.com" title="Astrill推广链接">Astrill</a>，大概一年70刀，最近又涨价了。而且现在竟然将DD-WRT单独出来做增值收费, 需要另付 $1/月。</p>

<p>如果你有root权限的主机，自建一个OpenVPN Server也是不错的选择。反正我就没有时间折腾，留给后来人做。</p>

<p>而淘宝上也有很多廉价VPN，总会有你合适的吧。想不花点钱还是不太靠谱吧？</p>

<p>顺便说说Astrill的优势在于服务器节点多，虽然很多速度也不怎么样，但香港节点和美国部分节点都非常的快，而且都不限流量。试过有一次通过New York节点下载XCode 4 ，是<strong>1MB/秒</strong>的速度。</p>

<h5>ADSL</h5>

<p>中国电信的8M ADSL</p>

<h3>安装调试</h3>

<h5>刷新固件</h5>

<p>硬件准备好后就可以开始刷设备了，从dd-wrt.com下载合适的rom文件到本地。针对我的RT-N16，我一共下载了三个文件</p>

<ul>
<li>dd-wrt.v24-14896_NEWD-2_K2.6_mini_RT-N16.trx</li>
<li>dd-wrt.v24-14896_NEWD-2_K2.6_mini.bin</li>
<li>dd-wrt.v24-14896_NEWD-2_K2.6_openvpn.bin</li>
</ul>


<p>用网线接上路由器，访问路由器设置网，找到通过本地上传方式<strong>更新固件</strong>的位置，必须先刷第一个文件，即扩展名为.trx的那个。刷新成功后，再刷其它，都非常简单就不表了。可以看看<a href="http://www.dd-wrt.com/wiki/index.php/Asus_RT-N16">这里</a></p>

<h5>设置路由</h5>

<p>如果使用的是Astrill服务，非常简单。连上网络后通过Astrill的客户端调出安装界面按提示执行就可以了。安装成功后在DD-WRT的路由设置页面进行设置，而且有专门针对GFW的设置，其实原理跟autoddvpn差不多，通过判断IP是否在墙内选择链路。</p>

<p>不过最后，我还是选择了使用autoddvpn介绍的最好模式graceMode。通过Astrill的傻瓜方式虽然可行，但：</p>

<ul>
<li>连接服务不知为何非常的慢。</li>
<li>访问国内网站cdn cache会失效</li>
<li>依赖VPN的稳定性，试过几次VPN掉了连国内网站都访问不到</li>
</ul>


<p>而autoddvpn是反向处理，使用的是本地DNS，对于部分指定的域名才走VPN链路。所以就算VPN不稳定的情况下，至少能保障国内的网站可以访问。</p>

<p>至于如何设置autoddvpn这里不说了，我认为官方的文档已经足够详细。如果你也像我一样使用Astrill VPN服务的话，通过ssh登录路由器，准备你的OpenVPN设置。</p>

<p>openvpn.conf文件需要用到的证书可以通过登录as trill的会员中心<em>VPN SERVICES -  OpenVPN certificates</em> 下载。<em>Server List</em>则可以获取当前的服务器状态和IP，选择几个最快的节点吧，我使用的是HK1和NY1。</p>

<h3>使用感受</h3>

<p>两个月来，在家上网的体验是最好的，唯一不足是最近路由器竟然连接不上，会自动死掉也不会重启，重启后很快又正常。也不知道是否因为刷了DD-WRT而不稳定，我听朋友说他家的官ROM还是非常稳定的，有空时我想重刷一次看看效果。</p>

<p>这样作在家里用倒不错，但出门后就有点麻烦了。手机还好，需要那个情况不好，而且twitter也可以用API Proxy解决。所以我的Mac还是装用iSSH和PAC以备不时之需。其实我想过段日子每天出街自备一个TP—LINK TL-WR800N，连上网络后再接家里的VPN Server端口再访问出去……但多绕啊！再看看吧，不一定弄了。</p>

<p>最后感觉变成Astrill的推广文了，不写了…其实我觉得如果有Linode的东京节点，自建个OpenVPN Server应该也是不错的选择。</p>

<p>如有问题欢迎跟我交流联系.</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/sinaly-will-be-discontinued">Sinaly将退伇</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-11-11T00:00:00+08:00" pubdate data-updated="true">Nov 11<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/sinaly-will-be-discontinued">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>一大早的，见到<a title="trunk.ly已经被AVOS收购，将整合到Delicious" href="http://blog.trunk.ly/2011/11/10/avos-acquires-trunkly/" target="_blank">trunk.ly已经被AVOS收购，将整合到Delicious</a>，同时trunk.ly将于2012年1月13日停止运作。那么我的同步程序<a title="发布我的应用–SiNALY" href="http://blog.roynotes.com/sinaly-python-released/" target="_blank">Sinaly</a>也可以于同一天停止动作了，大家尽快适应Delicious吧。</p>

<p>现在我的问题是还不知道如何将旧delicious的书签导入到新版？又如何将trunkly导入？</p>

<p>后者trunkly正在努力，我相信会有好的解决方案，祝贺trunk.ly团队</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/gitbox">Gitbox=git+dropbox</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-10-19T00:00:00+08:00" pubdate data-updated="true">Oct 19<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/gitbox">Permalink</a>
      </p>
    
  </header>

<div class="entry-content">自从没有每天背着手提电脑上班后，感觉颈椎真的轻松了很多，为了身体，未来一段时间也不会背着电脑移动。但电脑不移动后，就要想办法将办公室与家里的电脑同步，以保持文档版本的一致性。

现在云服务非常流行，当然将主要文档同步到云端去，我选择了一直使用的dropbox做简单的文档同步就好了。而又有一些属于私人性质的项目代码使用Git进行版本控制，当然我暂时不想将它们公开放到github，又不想购买私有仓库。当然用 [bitbucket](https://bitbucket.org/) 也不错，它现在已经提供免费的git私有仓库了。当然用dropbox DIY一个其实也挺靠谱的，你只需要这样做:

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='plain'><span class='line'>#工作目录 
</span><span class='line'>~/project $ git init
</span><span class='line'>~/project $ git add .
</span><span class='line'>~/project $ git commit -m "first commit"
</span><span class='line'>~/project $ cd ~/Dropbox/git
</span><span class='line'>
</span><span class='line'>#Dropbox目录 
</span><span class='line'>~/Dropbox/git $ mkdir project.git
</span><span class='line'>~/Dropbox/git $ cd project.git
</span><span class='line'>~/Dropbox/git $ git init --bare
</span><span class='line'>~/Dropbox/git $ cd ~/project
</span><span class='line'>
</span><span class='line'>#将工作目录推送到Dropbox云端
</span><span class='line'>~/project $ git remote add origin ~/Dropbox/git/project.git
</span><span class='line'>~/project $ git push origin master</span></code></pre></td></tr></table></div></figure>

</div>

  <footer>
    
    
  </footer>


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/archives/">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>

<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets" data-user="roy_wei" data-count="4" data-replies="false">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
    <a href="//twitter.com/roy_wei" class="twitter-follow-button" data-show-count="false">Follow @roy_wei</a>
  
</section>



<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/roymax?count=5&amp;sort=date&amp;callback=octopress.renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/roymax">My Delicious Bookmarks &raquo;</a></p>
</section>








  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - roymax -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'roynotes';
			var disqus_developer = '0';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>
