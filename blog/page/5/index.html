
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Roy Notes</title>
  <meta name="author" content="roymax">
  <meta name="Generator" content="Jekyll & Octopress (http://octopress.org)">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://roynotes.com/blog/page/5/">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/octopress.min.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Roy Notes" type="application/atom+xml">
  

<!--Fonts from Google's Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-44129046-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


   
  <link href="/octopress-favicon.png" rel="icon">
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Roy Notes</a></h1>
  
    <h2>21世纪的互联网居民</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:roynotes.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives/">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/one-year-and-five-months">Macbook 1年零5个月</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2011-01-14T00:00:00+08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2011</time>
         &bull; <a rel="bookmark" href="/blog/one-year-and-five-months">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>macbook于2009年8月21日入手，至今16个多月，主要用于上网、编码，极少游戏。</p>

<p>入手前从来没有用过osx，当时想买的机器有IBM，SONY型号，主要原因是mac有点贵，还跟以往的操作习惯不同。后来在香港官网见到翻新机（其实大部分是14天退货，维修有说明的），价格便宜了不少，先是因为翻新的原因打了折，还因为以港币结算，折算RMB还可以当打个折。再者想用不习惯OSX就被人鄙视一下装Windows吧，没什么大不了的，于是就入手了一台ch467。朋友拆包后带过关，跟全新别无二样，操作系统是tiger，后来用88块港币升级到snow，到手后就开始学习windows到osx的切换。</p>

<p>通过这16个月的坚持，死活在mac中找win下软件的对应解决方案，习惯osx的系统理念后，现在可以说我离不开OSX ，而且极不愿意回windows体系下去，我觉得OSX很好用，以至于有人问我该买什么笔记本，我都会说：“你应该需要一台macbook，而且远离windows”，以到于目前M$最好的操作系统 win7都差点都不会用了。</p>

<p>没有病毒，没有弹窗，没有注册表，没有IE，不需要碎片整理，不需要防火墙，系统不会越用越慢，良好的用户体验&#8230;&#8230;如果你拥有一台并且在运行着windows，应该试一试你的OSX系统，习惯一下就会被众多的细节所征服，浏览器配合触控板的多指手势的体验在windows下可是享受不到的。</p>

<p>对于开发人员拥有一台macbook绝对会为编程带来乐趣，原生就支持Java，Python，Perl，Ruby，PHP等，间接地令我对多用用python与ruby发生更多的兴趣。配合<a href="http://blog.roynotes.com/2010/08/03/the_homebrew_better_than_the_macports/">homebrew</a>这个开源软件包管理工具，安装git,hg,svn,ssh&#8230;&#8230;是多么的写意快捷。自从有了mac后，我仿佛又回到 DOS时代，通过Visor调出半屏透明的Shell窗口，喜欢敲打着命令行过着一半图形一半字符的生活，查找文件通过 ctrl＋ space调出spotlight基本可以搜索出来，运行程序也是用spotlight，我还是没有习惯用QuickSilver是因为觉得spotlight够用了。</p>

<p>现在唯一令我打开虚拟机运行windows的前提是：我需要使用网银系统！但好快我就可以不用了－－用手机银行解决一切问题。</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/thinking-architecture-and-performance-optimization-2009">游戏圈子平台架构及性能优化的思考 － 200912</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-12-30T00:00:00+08:00" pubdate data-updated="true">Dec 30<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/thinking-architecture-and-performance-optimization-2009">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>今天整理文档时找到这份2009年底写就的优化思路，只是当笔记的整理编写。用来指引今年的工作方向，但最终没有深化落实执行下去就离开了旧东家，实在可惜。
<h1>1.   概述</h1>
基于JAVA版本的游戏圈子平台于2008年8月18日正式上线运行，期间经历过多次改版及进行过一些架构调整。经过这一年半左右的时间积累，业务架构趋向清晰化，产品接口也趋向复杂化多样化，有必要在现阶段进行一次技术架构的优化及结合业务变化做出一些架构构想，便于下一阶段平台建设时作为指导思想进行架构调整。</p>

<p>同时，整理该份文档，有利于我们清晰现存的体系架构及面临的风险。
<h1>2.   优化的目的</h1>
为什么要做优化? 不外乎如下几种原因：
<ul>
	<li>节省资源，服务器、网络资源</li>
	<li>消除或者减少系统瓶颈</li>
	<li>提升用户体验</li>
</ul>
多数公司做优化都是从前两者出发，而&#8221;提升用户体验&#8221;虽然是从用户(网站访问者)角度出发，但却很少提升到非常重要的高度。</p>

<p>此外，或许也有炫技的因素在内，为了优化而优化，当然这是不可取的做法。
<h1>3.   一些数据</h1>
<ul>
	<li>* M注册用户，约*万个活跃用户(基于200912的唯一用户登录游戏数据推算)</li>
	<li>1M综合浏览量/月</li>
	<li>MySQL数据库稳定运行了211天，共792M次数据库查询请求，43.292 qps/天</li>
	<li>数据库读写比例是：r 74%/w 26%</li>
	<li>数据库峰值416个连接</li>
	<li>有9台PC服务器在运行
<ul>
	<li>其中6台提供线上服务，3台提供运维支撑</li>
	<li>2G memcached deamon</li>
</ul>
</li>
</ul>
<h1>4.   平台架构</h1>
现在游戏圈子平台主要使用JAVA和RUBY作为主要的开发语言实现。并且在部分产品上使用一些脚本语言来进行系统的维护支持，如：Lua、perl、php、python等。</p>

<p>JAVA部分包含旧有的遗留产品和平台的核心服务接口，如：论坛、支付中心、游戏登录和支付接口、后台服务进程等等。JAVA应用分为WebApp和独立运行的应用程序。WebApp运行在Resin 3.1.6应用服务器上，JVM配置2GB的最大可分配内存。</p>

<p>RUBY部分包含一些前端服务页面，现在只要有三个应用使用RUBY实现：帐号中心，个人管理中心，所有产品运营活动。RUBY运行于Lighttpd+FastCGI基于TCP/IP监听模式，每个应用同时开启5个backends进程进行处理，每个进程各稳定占用45 - 60mb内存不等，共3个应用，约占总内存 50 * 3 * 5 = 750mb</p>

<p>数据库使用MySQL 5.0.51b-log版本，运行在一主两从的复制模式。其中一台从机未有效利用，只能当备份库使用，存在资源浪费；另一台从机用来进行OSS数据分析查询使用。主库配置使用mysql 4GB内存的例子配置文件修改配置。</p>

<p>其中三台IBM的机器因挂接的磁盘柜只支持Red Hat,所以操作系统使用Red Hat Enterprise AS 4，内核是Linux 2.6.9-67。其他机器统一安装CentOS 5.2，内核是Linux 2.6.18-92.e15。
<h1>5.   找寻瓶颈在哪</h1>
如果我们需要系统优化，我们应该能够找到性能瓶颈，但现在系统的瓶颈还没有出现，是否不需要优化呢？</p>

<p>系统的瓶颈会在何方呢？如果系统有完善的监控分析系统的话，可以从统计数据和图形上看到大致的系统瓶颈所在。但是如果系统没有这些数据，按照一般的逻辑思路分析，将服务器细分为静态服务器，动态服务器，数据库服务器，业务逻辑服务器。分别针对这些服务器的带宽、内存使用、CPU使用率、磁盘IO进行基本分析。如对于动态服务器而言，其CPU的使用率一般情况下是其瓶颈；而对于静态文件服务器，由于其逻辑简单，但又需要传输大量文件，其出口的带宽、磁盘IO就很有可能是其瓶颈；数据库服务器则CPU和磁盘IO都可能瓶颈…我们需要根据这些数据结合经验来判断系统的负载是否达到瓶颈或接近瓶颈的预警判断。这些数据基于操作系统本身已经可以获取，而不需要我们去开发很复杂的应用监控。但系统本身产出的性能数据是不保存的，更理想的是，我们应该将利用一些开源软件组建一套更好的监控工具。</p>

<p>幸运的是，我们已经有一套现在看起来还非常不错的监控工具在运行着。而瓶颈通常还存在下面的问题：单点服务。
<h1>6.   寻找服务单点故障(Single Point of Failure)与高可用性（High availability）</h1>
系统是否需要负载均衡，是否需要避免单点？如何避免单点提高可用性是一个持续的课题。</p>

<p>单点故障从基础的硬件层，操作系统层，到数据库层，到应用程序层，再到网络层，都有可能产生单点故障。以上各个环节任何有一处出了毛病就造成部分或整体网络、服务受到影响，最简单的解决方法就是做冗余设备和服务，其次再进一点，做层次化便于隔离问题。隔离问题有助于我们发现单点，解决单点。</p>

<p>而可用性并不是一个模糊概念，实际上它能用数学方法来精确地表示。简单地讲，一个高可用性系统就是一个用户能随时使用的系统，例如当用户需要在早上8点到下午5点启用该系统时，该系统就应该在这段时间内保证良好的可用状态，其余的时间可以用来进行定期维修保养。可用性常被定义为实际的服务时间和要求的服务时间的比值，常用百分比表示。许多现代化系统需要一天24小时、一年365天连续不间断运转(有时也称为7×24或365×24)。一个可用性为99.9%的365×24系统一年的平均故障时间为8.76小时(525分钟)，而要想让系统的中断时间在一年中只有3分钟的话，系统必须有99.999%的可用性。
<h1>7.   系统架构的发展方向</h1>
<ol>
	<li>MySQL版本升级，打入性能优化补丁</li>
	<li>高可用性架构设计</li>
	<li>寻找并解决单点故障防患</li>
	<li>RUBY优化，安装RUBY企业级补丁</li>
	<li>完善服务点监控，建立服务成功率KPI</li>
	<li>思考应用整合，接口整合，建立企业级系统架构服务</li>
	<li>服务器应用清理调整，运维服务器与生产服务器分开</li>
	<li>平台向分布式系统过渡</li>
</ol>
系统架构优先或者说系统性能优化不能够按项目周期来做，系统构架的调整会根据企业的成长也一直在成长，这个成长过程也是形成企业的技术积累过程。</p>

<p>所以必须持之以恒的去探讨我们的架构，监控我们的系统，随时解决各种问题
<h1>8.   未来三个月目标</h1>
<ol>
	<li>优先MySQL
<ul>
	<li>MySQL 5.1已经发布了多个稳定版本，可以考虑升级,以获取性能20%的提升。</li>
	<li>Google为MySQL编写的开源性能优先补丁，经众多网站使用确实能为系统带来稳定性和高效率。</li>
	<li>参考MySQL 5.1手册，调整优先参数</li>
</ul>
</li>
	<li>优先Ruby</li>
	<li>打入Ruby Enterprise Edition补丁。</li>
	<li>生产与运维环境分离</li>
	<li>开发评估设计系统应用架构，消除应用单点，高可用性设计方案
<ul>
	<li>登录接口(Socket/WebServices)</li>
	<li>网站平台前外服务(Web)</li>
	<li>内部应用系统总线架构(SOA)</li>
	<li>数据库读写分离架构</li>
	<li>运维评估网络设备单点及服务高可用性方案</li>
</ul>
</li>
	<li>产品策划上从注重UI过渡到UE，应该给使用者一种「当然，应该这样」的感觉</li>
</ol>
<h1>9.   参考资料</h1>
l  <a href="http://ucdchina.com/snap/5684">http://ucdchina.com/snap/5684</a>
l  <a href="http://blog.totodo.com/archives/tag/ruby-%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8">http://blog.totodo.com/archives/tag/ruby-%E4%BC%81%E4%B8%9A%E5%BA%94%E7%94%A8</a>
l  <a href="http://robbin.javaeye.com/blog/518909">http://robbin.javaeye.com/blog/518909</a>
l  <a href="http://www.dbanotes.net/2009/11/web-single-point-of-failure.html">http://www.dbanotes.net/2009/11/web-single-point-of-failure.html</a>
l  <a href="http://www.eet-china.com/ART_8800105694_480101_TA_7426b0cb.HTM">http://www.eet-china.com/ART_8800105694_480101_TA_7426b0cb.HTM</a>
l  <a href="http://tech.ddvip.com/2009-05/1241492625117675.html">http://tech.ddvip.com/2009-05/1241492625117675.html</a>
l  一些网上下载的各大网站架构PDF文档</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/viral-marketing">“快好省”下的迫不得已–微盘那个讨厌的勾勾</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-12-24T00:00:00+08:00" pubdate data-updated="true">Dec 24<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/viral-marketing">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p><blockquote><span style="font-weight: 800;"><strong>病毒行销</strong>（<a title="英语" href="http://zh.wikipedia.org/zh-cn/%E8%8B%B1%E8%AF%AD">英语</a>：viral marketing）又称<strong>基因行销</strong>或<strong>核爆式行销</strong>，是一种<a title="讯息" href="http://zh.wikipedia.org/zh-cn/%E8%A8%8A%E6%81%AF">讯息</a>传递策略，通过公众将信息廉价复制，告诉给其它<a title="受众" href="http://zh.wikipedia.org/zh-cn/%E5%8F%97%E4%BC%97">受众</a>，从而迅速扩大自己的影响。和<a title="传统行销（尚未撰写）" href="http://zh.wikipedia.org/w/index.php?title=%E5%82%B3%E7%B5%B1%E8%A1%8C%E9%8A%B7&amp;action=edit&amp;redlink=1">传统行销</a>相比，受众自愿接受的特点使得成本更少，收益更多更加明显。</span></blockquote>
以上一段摘录于维基百科关于病毒行销的释义，简单的说就是一传十、十传百的道理。通常一个熟悉的人推介传递的信息是直接、可信、有效的，所以中国人自古以来认同“有口皆碑”，现代人称之为“口碑营销”（word-of-mouth communication）。</p>

<p>Hotmail是互联网初期最成功运用病毒行销的服务商之一，通过在每封免费发出邮件的底部附加&#8221;Get your private, free email at <a title="http://www.hotmail.com" rel="nofollow" href="http://www.hotmail.com/" target="_blank">http://www.hotmail.com</a>&#8220;使其在一年半的时间内吸引了1200万注册用户。</p>

<p>自从有了六度空间理论，病毒行销就真正的成为互联网生活的一部分。人们不停地被推介，人们主动地成为知名人仕、权威人仕、草根英雄的听众，接收他们的推荐。有些人甚至不做信息过滤就将信息二次传播，产品快速的形成影响力，占领市场。有些产品甚至不需要成千上万的广告投放而获取足够的人气，赚取丰厚的收入。</p>

<p>时到今日地球人都知道，新产品的推广方案里如果没有病毒行销是怎么也说不过去的。即使只是建立一个博客，也得想方设法的将它推销出去，于是人们不停的登录社区化网站，不停的<strong><span style="font-size: medium;">Build an audience</span></strong>。</p>

<p>构建听众是一个漫长的过程，某些产品运营人员就是没有用心地去经营这个过程，而用了一些取巧的传播手段。如在微盘上下载文件页面的那个”转发此文件“的小勾勾，我专门发了一条<a href="http://t.sina.com.cn/1666183302/5KC58bDqGKi" target="_blank">微博</a>痛骂运营人员的”不损手段“，而@<a href="http://t.sina.com.cn/1703532323">咬人的小虾</a> 同学就要求我明白什么是“迫不得已”与“快好省”，这非常扯淡。在互联网上，没有任何产品是不可替代的，产品认同度来自于人之间的口味相投，你的”迫不得已“已招至人们的排斥时你还无动于衷，那已经离消灭不远了。</p>

<p>好吧，微盘那个勾勾有什么问题？首先看看它跟其他分享转发有什么不同。在查看每一条微博是不会进行转发的，如果进行转发你必定认为它是有趣、有价值、有意义的，其实你是在做着信息过滤的工作，你是在对自己负责，这就是你。hotmail是通过熟人网络进行传播的，底部的广告多少有些强制性，但这个传播是单一的，它始终在推销着“hotmail&#8221;这个与众不同的电子邮件产品，而且它当时真的足够的好用，足够的酷，人家都愿意推销它（当然，现在不是了）。</p>

<p>微盘呢？传播者将自己认为好的东西上传到微盘，然后通过微博通知大家到达页面进行下载，这是一次传播，主动发生的。而微盘的运营人员为了使用户能够快速地形成二次、三次传播做了一个小小的诡计，设置了一个默认选中”转发此文件“的小勾勾（刚开始连这个button都没有），当用户确认下载文件时自动将用户下载行为通告于微博，使用户听众得到传播。微盘被我厌烦之处在于：
<blockquote>
<ul>
	<li><strong>转发是基于内容，由微盘共享出来是基于文件的</strong></li>
	<li><strong>该次转发的微博内容（微盘共享的文件）并未被我确认是有意义、有趣、可信的。</strong></li>
	<li><strong>基于上一条，我没有义务去推广微盘和该次下载的文件</strong></li>
	<li><strong>如果我推广出去了，是我的工作失误，我没有对我的听众尽责</strong></li>
	<li><strong>下载文件是我的隐私，我的隐私不应该被默认公开</strong></li>
	<li><strong>基于以上各条，为什么”转发此文件“是默认的？</strong></li>
</ul>
</blockquote>
我不排斥病毒行销的方式，而且我好鼓励病毒行销，我很愿意做那个被动接受的家伙。互联网本来就是探索发现分享的世界，这个信息世界太大，我的时间太少，我不能将我所有的时间用来探索发现这个世界所有美好有趣的东西，所以需要高价值的导读和评论，然后再将我认为正确的转发分享出去，绝不做信息传播的被动奴隶。</p>

<p>如果不能改变，那么放弃它。我用<a href="https://www.dropbox.com/referrals/NTI0NzM5NTE5?src=global0">Dropbox</a> ~ 绝对的推荐</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/michael-learns-to-rock-in-my-life">我的MLTR情结</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-12-10T00:00:00+08:00" pubdate data-updated="true">Dec 10<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/michael-learns-to-rock-in-my-life">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p><a href="http://assets.roynotes.com/uploads/2010/12/3888249003_42d3b7a4fd_z.jpg"><img class="aligncenter size-full wp-image-28120" title="3888249003_42d3b7a4fd_z" src="http://assets.roynotes.com/uploads/2010/12/3888249003_42d3b7a4fd_z.jpg" alt="" width="640" height="426" /></a>很多人可能因为张学友的《吻别》英文版《take me to your heart》从而知道MLTR这一乐队。而我，对于他们的喜爱由来已久，来自于高中时代的一曲《That&#8217;s why?(you go away)》，屈指一算应该也有15个年头了。</p>

<p>这队Band完全就不是一支高产的乐队，接近两年才出一张专辑，有时候会更久。但无论时间多久，当我看到有他们的新专辑时总是会兴奋好一阵子。</p>

<p>05年的时候，他们在中国巡回演唱，但没有广州站。某一年，或许是九运会的一次大型演出活动，他们来到广州跟胡彦斌一起演唱。这些我都错过了，“如果MLTR来广州，我一定去看他们的演唱会”就像是我的一个梦。</p>

<p>其实我真的不知道他们会在2010年12月10日这一天会在广州开演唱会的，多谢我的好友在12月9日时将58同城团购信息告诉我，让我以最低的价格拿到很好的位置，让我能够完成我这个梦。</p>

<p>话说这是我的第一次到现场听演唱会，现在兴奋期待中。就像朋友说的：一个年过30年老家伙带着妻子去追星，还是三个老男子的Band</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/play-with-scala-is-not-as-perfect-as-imagined">Play With Scala?并不是想像中的那样完美</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-12-04T00:00:00+08:00" pubdate data-updated="true">Dec 4<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/play-with-scala-is-not-as-perfect-as-imagined">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p><h2>关于Scala</h2>
今年年初对Scala发生了兴趣，并读了几篇关于它的文章，也安装了runtime环境写一些Demo代码 。函数式的编程风格，天然的多核支持，简洁的多线程代码，自适应静态类型，闭包，还是运行在JVM上的编程语言，能与众多的JAVA项目良好的混搭起来。实际上Scala类编译后就是Java字节码，这对于Java开发者人员是有致命性诱惑的。
<h2>遇见PlayFramework</h2>
出于对Scala的一点了解和兴趣，也寻找了一些支持Scala的Web开发框架。首先我找到了liftweb，它完全基于Scala开发的Full Stack框架，但我真的不太喜欢stateful框架，当我看了一些lift的例子后就对于它没有兴趣了。直到知道Play从1.1版本开始支持Scala，并且Play的酷特性包括&#8230;&#8230;.（省略了，不是重点）当时play 1.1还是beta版本，我也决定选择做我的一个小型项目架构，这种rails-like的java实现和share nothing架构值得我对它关注。最重要的是，当时我想，我可以这里写写java，那里写写scala，多么变态的想法。
<h2>不完美&#8230;&#8230;</h2>
但，世事总是有不完美的时候，play+scala其实并不是那么好的.毕竟play骨子里还是java编写的，打开play scala module的源代码就会知道，那只是一堆Delegate类、Helper类而已。如在ScalaController中的这两行：
<p style="padding-left: 30px;"><strong>def</strong> <strong>Json(</strong>json<strong>:</strong> <strong>String)</strong> <strong>=</strong> <strong>new</strong> <strong>RenderJson(</strong>json<strong>)</strong></p>
<p style="padding-left: 30px;"><strong>def</strong> <strong>Json(</strong>o<strong>:</strong> <strong>Any)</strong> <strong>=</strong> <strong>new</strong> <strong>RenderJson(new</strong> com<strong>.</strong>google<strong>.</strong>gson<strong>.Gson().</strong>toJson<strong>(</strong>o<strong>))</strong></p>
当scala用多了，你就不想用java的语法了.既然不想用了，就会认为那是代码的臭味道，跟着就想着去修改它，修改成Scala风格的。可惜有时也无能为力，毕竟Play的底层还是Java，只是用Scala做了桥接，代码中总是有那么一点咖啡味。</p>

<p>举些例子:
<ul>
	<li>在Model中，你的字段属性必须定义为var，不能为val，它一定是要可变的。（在lift中将属性字段设置为object）</li>
	<li>在Model是存在一对多关系时，One映射Many请用java.util.List而不能是scala.List，因为JPA不理解scala.List(其它基于Collections的同理)</li>
	<li>基于上一条，如果foo.bars返回bar的集合,你想使用bar.foreach语法，对不起，请你先做
<span style="color: #ff6600;">import scala.collection.JavaConversions._<br />
foo.bars.foreach(bar =&gt; println(bar.id))</span></li>
	<li>如果要返回Json或Xml格式到View，单个对象还好，能正常返回。如果是一对多对象就有问题了。如果没有嵌套关系，可以
<span style="color: #ff6600;">def index = {       	    Json(Role.findAll.toArray)    }</span>
这样返回正确的Json，否则按照<a href="http://groups.google.com/group/google-gson/msg/b7637a04522ca28c">http://groups.google.com/group/google-gson/msg/b7637a04522ca28c</a>这里做吧。要知道，在Java版本的Play是不存在这个问题的。造成这个问题的原因，说到底就是因为反射。具体可以看看这个贴子说的<a href="http://groups.google.com/group/play-framework/browse_thread/thread/5639a3d3c15dbd51">http://groups.google.com/group/play-framework/browse_thread/thread/5639a3d3c15dbd51</a></li>
</ul>
目前来说，这是我不那么喜欢Play+ Scala的一些东西。当然相对于Liftweb，我还是喜欢Play+Scala。</p>

<p>如果需要一个完全scala风格的框架，目前应该也就只有Liftweb合适。或许有人说是<a title="Home" href="http://www.scalatra.org/">Scalatra</a>，但我没有真正用过，甚至了解过，不作评论。但如果喜欢PlayFramework的框架，只是想体验一下scala编程的乐趣，或作为Java-&gt;Scala过渡，Play with Scala</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/balsamiq-mockups-cross-platform-prototype-design-tool">Balsamiq Mockups – 跨平台产品原型设计工具</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-11-30T00:00:00+08:00" pubdate data-updated="true">Nov 30<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/balsamiq-mockups-cross-platform-prototype-design-tool">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>产品原型设计是技术开发团队与产品团队之间沟通的桥梁，有了它我们能能够更好的沟通。毕竟以图形为主要输出的原型比大量<strong><a href="http://www.baidu.com/s?wd=%BB%DE%C9%AC%C4%D1%B6%AE&amp;f=12&amp;rsp=0&amp;oq=%BB%D2%C9%AC%C4%D1%B6%AE">晦涩难懂</a></strong>文字堆砌起来的所谓需求文档，甚至啥都没的‘口交’强得多（我是指&#8217;口头交流&#8217;）。</p>

<p>我不是专职的产品设计人员，我只是一个程序员。但是有时我也需要使用一些原型设计工具来协助我完成一些工作，过去我试用过VISIO,OmniGraffle，Axure PR&#8230;&#8230;还有一些忘记名字的，不是不满意它们的功能，是不满意他们功能真的太强大的，它同样意味着太笨重了。有时候我真的只需要一些简单的原型设计（线框图）而不是高保真原型。深点层次的原因是：我有个伙计在用Ubuntu，而我在用Mac OSX，我们的产品经理在用着Win 7，也就是说我们的原型需要在三个不同的操作系统上可以显现，当然导出后再分享是可行方案，老实说我更喜欢Axure PR 基于SVN的分享方式。</p>

<p>当我遇到<a href="http://balsamiq.com/" target="_blank">Balsamiq Mockups</a>，我还真的有点喜欢它：轻量级的，简单的，易用的。基于涂鸦式的手绘风格的原型，令我不会再去纠结于摆放的整洁与否，只需要把我的想法放上去，并告诉大家我的想法。高保真可交互原型？老实说有时我真的不需要它了，先把那些炫酷效果的想法放一边吧，先写个Note记下来如何？程序员们会帮你实现它的。我觉得在产品设计初期，高清图是没有任何作用的，先把整体的构思框出来吧。</p>

<p><a href="http://assets.roynotes.com/uploads/2010/11/gzmtr4iphone.png"><img class="aligncenter size-large wp-image-28094" title="广州地铁查询 for iphone" src="http://assets.roynotes.com/uploads/2010/11/gzmtr4iphone-1024x696.png" alt="" width="662" height="449" /></a></p>

<p>我最满意的地方在于，mockups的bmml文件格式是基于xml文本格式的，不是二进制。这意味着你可以通过你最喜欢的SCM工具进行版本管理，多人协同工作同时编辑修改。而且它的文件格式是开放式的，允许第三方协作者基于它开发自己的应用程序。<a href="http://www.sketchyapp.com/">SketchyPad</a>和<a href="http://www.endloop.ca/imockups/">iMockups</a>就是基于他们文件格式所完成的iPad应用程序。</p>

<p>当然，它也有一个缺陷，软件本身不能导出HTML格式，你需要借助一些第三方程序来完成，如：<strong><a href="http://www.napkee.com/">Napkee</a></strong>。无论如何，我觉得可以满足我的需要了。</p>

<p>如果你想体验一下，可以试试<a href="http://builds.balsamiq.com/b/mockups-web-demo/" target="_blank">在线版本</a>。我说了，是跨平台的，也可以下载一个适合你的<a href="http://balsamiq.com/download" target="_blank">桌面版本</a>试试。但请先安装<a href="http://get.adobe.com/cn/air/" target="_blank">adobe air</a>.还有一个酷plugin，你可以将mockups集成到 Jira/FogBugz/XWiki/Confluence。</p>

<p>控件库太少？那么去<a href="http://mockupstogo.net/" target="_blank">http://mockupstogo.net/</a>下载吧，或许有你想要的，但请自带爬墙工具。</p>

<p>如果一个工具能大幅提高企业的工作效率，79美元还真的不贵。但对于我个人来说嘛，免费总是好的。所以体贴的作者推出“<a title="免费获得Balsamiq Mockups的license key" href="http://www.balsamiq.com/products/mockups/desktop#buy" target="_blank">免费获得Balsamiq Mockups许可证密钥的几个方法</a>”:
<blockquote>
<ul>
	<li>如果你是非营利、慈善机构、开源贡献者；</li>
	<li>如果你是技术/软件博客作者或者记者；</li>
	<li>如果你是学校高中班老师；</li>
	<li>如果你加入可用性专业培训；</li>
	<li>如果你是大学的教授或者学生；</li>
</ul>
</blockquote>
同时，写一封邮件索要注册码
<blockquote><em>邮箱：free@balsamiq.com<br />
主题：I want to review Mockups on my software blog!<br />
内容：关于Balsamiq Mockups介绍的博客URL</em></blockquote>
所以，我完成了这篇Blog，不知道会不会发给我免费的Mockups注册码呢？</p>

<p>Update: 五小时后，我收到回信，他们已经不再提示免费许可给博客作者了。唉～没review协议，白写了，哈哈～～～不过，无论如何，也是一个好工具.</p>

<p>下面是回信内容：
<blockquote><em>Hello Roy,</em></blockquote></p>

<p><em>We no longer offer free evaluation licenses to bloggersbecause we<br />
changed our trial to be a fully-featured 7-day demo.</em></p>

<p><em>This should give you enough time to get a feeling for the application<br />
in order to write a review of it. If that&#8217;s not enough time, let me<br />
know and I&#8217;ll send you another demo key for one additional week.</em></p>

<p><em>You can download the 7-day Mockups for Desktop demo here:<br />
http://balsamiq.com/download</em></p>

<p><em>I&#8217;m looking forward to reading your review!<br />
Any questions, we&#8217;re here.<br />
Natalie</em></p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/javaeye_gfw">记JavaEye被封</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-11-22T00:00:00+08:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/javaeye_gfw">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>午间javaeye.com突然被封，技术社区都在讨论为什么技术内容型网站也会遭遇被封的命运。其实我们也见怪不怪了，如:python，就因为他的官网是.org，刚好python.com就是一个三俗网站。所以，大家也在热议到底javaeye动了工信部哪根筋，基本都猜测问题出在论坛、小组、博客中的内容.</p>

<p>纷扰近一小时，创始人Robbin范凯在<a href="http://t.sina.com.cn/1654762921/zF0tcU3KGU" target="_blank">新浪微博</a>中透露是由于他写的反爬虫防火墙太智能导致被封，原文如下：
<blockquote>JavaEye杯封是因为我写的动态防火墙代码太智能了，把电信负责内容监控的爬虫给封了，结果我就被封了。这年头，代码写的好也是杯具啊。把监控爬虫加入白名单了，争取下午恢复网站访问。</blockquote>
刚好早上还在看Robbin的新博文“<a href="http://cache.baidu.com/blog/451014" target="_blank">互联网网站的<strong>反爬虫策略</strong>浅析</a>”,结果正是做了这个策略程序被封。</p>

<p>天朝一如既向地在关注我们提示的服务及发言，你也别想躲起来，如果你敢，等待的就是把你调到墙外。</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/a-story-and-a-cake">讲故事与做蛋糕</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-11-15T00:00:00+08:00" pubdate data-updated="true">Nov 15<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/a-story-and-a-cake">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>女人最期望的东西就是丈夫跟她讲将来，说理想。让她能够知道丈夫如何规划他们的生活，对未来充满憧景与希望，幸福的感觉也油然而生；父母也希望听孩子说他们的理想，如何去规划自己的人生与未来，从而可以得知儿女已经成长懂事不再为他们操心和忧心。</p>

<p>当然，这个故事得必须讲到动听，丰富，紧凑，煽情，真诚，逻辑结构合理，有美好的未来。告诉家人，理想是什么，如何去做，为他们带来什么，不停的告诉他们，现在做得如何，让大家跟随你的脚步。这一切为你赢得尊重、支持、信任&#8230;&#8230;</p>

<p>做蛋糕当然是指去实现故事，像自己亲手做蛋糕一样做到亲人们吃，从准备材料、搓面、煮水、搅拌做起&#8230;&#8230;这个蛋糕最初尝试做时可能会失败，失败再失败，总有一天我们会成功。不论成品是甜是苦是咸&#8230;&#8230;它就是所经历过付出过所做出来的蛋糕，五味俱全又如何呢？这是一个回味无穷的蛋糕。而且我们可以不止做一个蛋糕，我们可以不停学着地做不同的名种，而且还要做得一个比一个大。</p>

<p>人生就该如此，学会讲故事，可以跟家人走得更亲近。学会做蛋糕，可以跟家人享受一路走来的甜酸苦辣。</p>

<p>我见过的所有成功的人，都非常懂得讲故事，他们能够打动我的心。他们的故事就是他们所做的企业的文化的一部分；他们的故事可以是我工作中的指引，能纠正我的错误；他们的故事能让企业走得更远&#8230;&#8230;.</p>

<p>可惜，我从未尝试过做这样一种人，现在我也想学习如何成为这样一个人</p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/playframework_1_1_coming_soon">Play!framework 1.1正式版指日可待</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-10-26T00:00:00+08:00" pubdate data-updated="true">Oct 26<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/playframework_1_1_coming_soon">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>自10月份以来连续放出三个RC版本，估计Play! 1.1的里程碑发布将指日可待了。在新版本中包含的特性是非常精彩，它们令Play!框架更加完整完善。当时，个人感觉跟Rails在某些细节上还是有一些差距的。</p>

<p>首先的一点是，插件不如Rails丰富。即使GRails也不如。Play要获取爆炸式的发布的话，grails社区能否积极地参与进来及是否有更多的ssh开发者投入到该阵型并开发更多的模块插件有着很大的关系。</p>

<p>rails的一栈式服务，原生就能够做到各层的代码生成，无论是正向还是反向的。如rails的models 是动态生成的，不是特殊情况，是不必手工处理ORM的映射关系。在Play!中你需要通过JPA annotation来做实体的映射关系，虽然有一个module插件(<a title="play-db" href="http://www.playframework.org/modules/db" target="_blank">play-db</a>)可以解决这个问题，但截至目前为止，该module 在做包含外键关系的代码生成时会出错而不可用。同时对于我最大的问题是：它不支持scala。</p>

<p>还有那个cookie based session的问题，对于rails来说，这是可选方案，但对于Play来讲这是唯一方案。你得自己去做另外的实现，比如memcached based&#8230;..</p>

<p>&#8230;&#8230;</p>

<p>总体感觉细节上还是不如Rails，当初选择Play！是因为它支持Scala语言，看起来真的好Cool，但记住，Play！只是轻度支持。什么意思？它并非原生支持Scala，只是在框架上多了一个Module，令你可以使用Scala的语法来构建应用。说到底，它的底层实现还是基于Java的。所以有时候调用起来还是有点儿别扭了。</p>

<p>如果是Scala的重度Web开发感染者，我还是建议你去玩Liftweb算了，纯Scala实现，多拉风啊！我只是不喜欢它的框架是statefull实现。</p>

<p>无论如何，以下是我最喜欢的五个新特性！期待1.1的正式版发布。
<ul>
	<li>Scala language support</li>
	<li>Native Glassfish deployment support</li>
	<li>Virtual hosting in routes</li>
	<li>New powerful async WS library</li>
	<li>OAuth support</li>
</ul>
PS:
<ul>
	<li>我正在用Play! 1.1来构建两个应用。其中一个基于Java，另一个基于Scala</li>
	<li>1.1已于11月1日发布(更新于2010.11.2)</li>
</ul></p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/blog/print-unicode-characters-to-the-osx-terminal-with-java">Print Unicode Characters to the OSX Terminal With Java</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2010-09-30T00:00:00+08:00" pubdate data-updated="true">Sep 30<span>th</span>, 2010</time>
         &bull; <a rel="bookmark" href="/blog/print-unicode-characters-to-the-osx-terminal-with-java">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>在OSX环境下，如果你没有使用Eclipse、NetBeans等IDE来编写Java代码，当使用sysout或Logger向控制台输出UTF8字符时是会出现乱码。</p>

<p>比如我们编写一个类来测试一下（OSX terminal和textmate均已经配置为UTF8编码）
<code>
# export LANG=zh_CN.UTF-8<br />
# touch T.java<br />
# mate T.java
</code></p>

<p>然后，我用textmate来编辑并录入以下内容
<code class="java">public class T<br />
{
public static void main(String[] args) {<br />
System.out.println("中文");<br />
}
}</code></p>

<p>我尝试在终端下编译并运行它</p>

<p><code># javac T.java<br />
T.java:4: ???棺???? EUC_CN ?Ĳ???ӳ???ַ?<br />
System.out.println("???");<br />
^
T.java:4: ???棺???? EUC_CN ?Ĳ???ӳ???ַ?<br />
System.out.println("???");<br />
^
</code></p>

<p>明显是因为识别不到UTF8引起错误。其实我们编译时需要加入参数-encoding UTF8 可以解决这个问题
<code>javac -encoding UTF8 T.java</code>
但在同理在运行这个T.class我们也要加入输出的编码参数，以令Java不使用默认的输出编码(ISO8859)
<code>java -Dfile.encoding=utf8 T</code></p>

<p>至此，已经知道如何解决Java在OSX终端下显示utf8的问题了。但如果你在textmate中执行cmd+R(安装了<a href="http://github.com/alkemist/Java.tmbundle">Java.tmBundle</a>)，你会发现问题跟刚才讲的如出一撤，无法运行。其实这里有点小BUG，插件作者同样没有处理了javac的编译问题，你可以编译以下文件修复这个问题
<code># mate ~/Library/Application Support/TextMate/Bundles/Java.tmbundle/Support/bin/java_compile_and_run.sh
</code>
在第16行和第21行添加参数-encoding UTF8，如下：
<code>
......<br />
"$TM_JAVAC" -encoding UTF8 -d "$output" $TM_JAVA_FILEGLOB; rc=$?;<br />
.......<br />
"$TM_JAVAC" -encoding UTF8 -d "$output" "$SOURCE"; rc=$?;<br />
........
</code></p>

<p><code><code> </code></code></p>

<p><code><code>保存，再运行一次cmd+R看看，应该就正常了。(这里是我修复的派生版本：<a href="http://github.com/roymax/Java.tmbundle" target="_blank">http://github.com/roymax/Java.tmbundle</a>)</code></code></p>

<p><code><code>在PlayFramework中，通常会在命令行中play run 或play test，如果我们在终端同样有输出的话，也会乱码。<br />
要修改这个问题，可以编辑在PLAY_ROOT/中的play(基于1.0)或PLAY_ROOT/framework/pym/play/下的application.py（基于1.1 beta2)文件，在文件中找java_cmd，在它前面加入一行
<code>java_args.append ('-Dfile.encoding = utf8'); </code>
基于Python代码的特性，请记住，这一行需要跟java_cmd是并列缩进的，如果你懂py，估计你知道我在说什么了<br />
或者如果不想改动Play的原文件，那么你在启动时这样做了，一样可行
<code>play run -Dfile.encoding=utf8 </code>
Notes: Play的作者说已经修复这个问题在仓库主干了，也许下一版本就不需要这么麻烦</code></code></p>

<p></p>
</div>

  <footer>
    
    
  </footer>


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/6/">&larr; Older</a>
    
    <a href="/archives/">Blog Archives</a>
    
    <a class="next" href="/blog/page/4/">Newer &rarr;</a>
    
  </div>
</div>

<aside class="sidebar">
  
    
<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets" data-user="roy_wei" data-count="4" data-replies="false">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
    <a href="//twitter.com/roy_wei" class="twitter-follow-button" data-show-count="false">Follow @roy_wei</a>
  
</section>



<section>
  <h1>On Delicious</h1>
  <div id="delicious"></div>
  <script type="text/javascript" src="http://feeds.delicious.com/v2/json/roymax?count=5&amp;sort=date&amp;callback=octopress.renderDeliciousLinks"></script>
  <p><a href="http://delicious.com/roymax">My Delicious Bookmarks &raquo;</a></p>
</section>








  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - roymax -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'roynotes';
			var disqus_developer = '0';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>
